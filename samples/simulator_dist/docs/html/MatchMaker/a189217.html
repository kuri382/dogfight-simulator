<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MatchMaker: MatchMaker.MatchMaker Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="asrc_doc_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MatchMaker
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('a189217.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">MatchMaker.MatchMaker Namespace Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Copyright (c) 2021-2025 Air Systems Research Center, Acquisition, Technology &amp; Logistics Agency(ATLA)  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-nested-classes" class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:MatchMaker" id="r_MatchMaker"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a191163.html">MatchMaker</a></td></tr>
<tr class="memitem:MatchMonitor" id="r_MatchMonitor"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a191167.html">MatchMonitor</a></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Copyright (c) 2021-2025 Air Systems Research Center, Acquisition, Technology &amp; Logistics Agency(ATLA) </p>
<p>複数のPolicyの重み保存、読み込みを管理しつつ、 その勝率等に応じたエピソードごとの対戦カードを生成するための基底クラス群であり、以下の2つのクラスからなる。</p><ol type="1">
<li>一つだけ生成し、全体の管理を行うMatchMaker</li>
<li>実際にエピソードを実行するインスタンスごとに生成し、対戦結果を抽出してMatchMakerに渡すresultを生成するMatchMonitor</li>
</ol>
<dl class="section user"><dt>使用方法</dt><dd></dd></dl>
<ol type="1">
<li><p class="startli"><a class="el" href="a191163.html">MatchMaker</a> のコンストラクタ引数について</p>
<p class="startli"><a class="el" href="a191163.html">MatchMaker</a> クラスのコンストラクタはdict型の引数configをとる。必須のキーは以下の通り。 </p><div class="fragment"><div class="line">config={</div>
<div class="line">    <span class="stringliteral">&quot;restore&quot;</span>: <span class="keywordtype">None</span> <span class="keywordflow">or</span> str, <span class="comment">#チェックポイントを読み込む場合、そのパスを指定。</span></div>
<div class="line">    <span class="stringliteral">&quot;weight_pool&quot;</span>: str, <span class="comment">#重みの保存場所。&lt;policy&gt;-&lt;id&gt;.datのようにPolicy名と重み番号を示すファイル名で保存される。</span></div>
<div class="line">    <span class="stringliteral">&quot;policy_config&quot;</span>: { <span class="comment">#Policyに関する設定。Policy名をキーとしたdictで与える。</span></div>
<div class="line">        &lt;Policy<span class="stringliteral">&#39;s name&gt;: Any, #具象クラスごとの様式に従った各Policyの設定</span></div>
<div class="line"><span class="stringliteral">        ...</span></div>
<div class="line"><span class="stringliteral">    },</span></div>
<div class="line"><span class="stringliteral">    &quot;match_config&quot;</span>: Any <span class="comment">#対戦カードの生成に関する指定。具象クラスで自由に定める</span></div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><a class="el" href="a191163.html">MatchMaker</a> と MatchMonitorの生成</p>
<p class="startli">学習プログラムにおいて、メインプロセスで一つだけ <a class="el" href="a191163.html">MatchMaker</a> インスタンスを生成する必要がある。 また、 <a class="el" href="a191167.html">MatchMonitor</a> はエピソードを生成するWorkerインスタンスごとに生成する必要がある。</p>
</li>
<li><p class="startli">resultの伝達</p>
<p class="startli">学習プログラムに適した方法にて、各 MatchMonitor.onEpisodeEndが抽出したエピソードの結果をMatchMaker.onEpisodeEndに供給する必要がある。</p>
</li>
<li><p class="startli">対戦カードを環境に反映するための機構の準備</p>
<p class="startli">学習プログラムにおいて、生成された対戦カードを用いて環境の生成を行う機構も必要である。</p>
</li>
<li><p class="startli">重みの読み書きや初期化に関する処理の実装</p>
<p class="startli"><a class="el" href="a191163.html">MatchMaker</a> / MatchMonitorは特定の強化学習ライブラリに依存させないために、重みを直接扱わないようにしている。 そのため、重みの読み書きや初期化を実際に行う処理は学習プログラム側で準備する必要がある。</p>
</li>
</ol>
<dl class="section user"><dt>カスタマイズの方法</dt><dd></dd></dl>
<p>実際に <a class="el" href="a191163.html">MatchMaker</a> を使用するうえでは、環境の仕様に応じて以下の関数群を適宜オーバーライドして使用する。</p>
<ol type="1">
<li><p class="startli"><a class="el" href="a191163.html#a96d992c7a89abf61deaa8dc857fe4525">MatchMaker.makeNextMatch</a> のオーバーライド</p>
<p class="startli">対戦グループ(○○リーグのようなイメージ)を表す何らかの変数matchTypeを引数にとり 何らかの対戦カードを返す関数であり、各ユーザーが独自の対戦方式を実装するものである。</p>
<p class="startli">対戦カードはdictで表現され、場に登場するチームごとにどのPolicyのどの重みを使うかをキー"Policy"と"Weight"により指定する。</p>
<p class="startli">また、同名のPolicyで異なる重みを複数同時に使用したい場合等のために、それらを区別するための"Suffix"を指定可能である。</p>
<p class="startli">重み番号は基本的に</p><ul>
<li>負数(-1): 学習中の現物</li>
<li>0: 学習中重みの最新のコピー(随時更新される)</li>
<li>自然数: 過去のある時点で保存されたコピー</li>
</ul>
<p class="startli">とすることを想定しているが、 <a class="el" href="a191163.html">MatchMaker</a> を使用する学習プログラムの書き方次第である。</p>
<p class="startli">また、これら以外に必要な情報があれば適宜追加してもよい。まとめると、以下のような書き方になる。 <span class="tt">python
    {
        "teams": {
            &lt;Team's name&gt;: {
                "Policy": str, # teamを動かすPolicyの名前
                "Weight": int, # teamを動かすPolicyの重み番号
                "Suffix": str, # teamを動かすPolicyの接尾辞。同名のPolicyで異なる重みを使用する場合等に指定する。省略は不可。
            }
        },
        "common": dict # teamに依存しない条件(Rule等)を記述する。派生クラスで定義する。
    }
    </span></p>
</li>
<li><p class="startli"><a class="el" href="a191163.html#adcf8b505609a775d9db33cbf1a0c2ddf">MatchMaker.onEpisodeEnd</a> のオーバーライド</p>
<p class="startli">いずれかの対戦が終わったときに呼び出し、その対戦を実施したインスタンスにおける次の対戦カードを生成して返す関数。</p>
<p class="startli">引数は、終了した対戦のmatchInfoと、対応する <a class="el" href="a191167.html#a95fa131af5147bc933f3b49b40a92ca6">MatchMonitor.onEpisodeEnd</a> で生成されたresultを与えるものとする。 また、返り値として、重み保存要否を記したdictを返す必要がある。 基本的には重み保存を行うPolicyのみを対象として以下のようなdictとして記述することを想定している。 </p><div class="fragment"><div class="line">{</div>
<div class="line">    &lt;Policy<span class="stringliteral">&#39;s name&gt;: {</span></div>
<div class="line"><span class="stringliteral">        &quot;weight_id&quot;</span>: int, <span class="comment"># 保存先の重み番号</span></div>
<div class="line">        <span class="stringliteral">&quot;reset&quot;</span>: bool, <span class="comment"># 保存後に重みをリセットするかどうか</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li><p class="startli"><a class="el" href="a191167.html#a95fa131af5147bc933f3b49b40a92ca6">MatchMonitor.onEpisodeEnd</a> のオーバーライド</p>
<p class="startli">環境インスタンスごとに対戦結果を抽出して <a class="el" href="a191163.html">MatchMaker</a> に渡すresultを生成する関数。</p>
<p class="startli"><a class="el" href="a191163.html#adcf8b505609a775d9db33cbf1a0c2ddf">MatchMaker.onEpisodeEnd</a> で重み保存や次回の対戦カードの生成の判定を行うために必要な情報があれば、環境インスタンスから抽出して返す。</p>
</li>
<li><p class="startli"><a class="el" href="a191163.html#a13a186f9bc44d3ec5be3d732ff846425">MatchMaker.checkInitialPopulation</a> のオーバーライド</p>
<p class="startli">学習開始時の重みをweight_poolに追加するかどうかを返す関数。返り値の形式はonEpisodeEndと同じ。 用途としては、別の学習済モデルを読み込んで開始したときにその初期状態を対戦候補に含めたいような場合等が考えられる。</p>
</li>
<li><p class="startli"><a class="el" href="a191163.html#a24dfe65154bf53310df90b3eb970f991">MatchMaker.get_metrics</a> 関数のオーバーライド</p>
<p class="startli">Tensorboardログ等に記録するための値を格納したdictを返す関数として、必要に応じてオーバーライドする。</p>
</li>
<li><p class="startli"><a class="el" href="a191163.html#a20ad8c2304313b8fc9ba631c005dbad5">MatchMaker.initialize</a>, load, saveのオーバーライド</p>
<p class="startli">MatchMakerの初期化やチェックポイントの生成、読み込みを行うための各関数を必要に応じてオーバーライドする。 </p>
</li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="a189216.html">MatchMaker</a></li><li class="navelem"><a href="a189217.html">MatchMaker</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
