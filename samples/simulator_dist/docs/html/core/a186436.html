<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ASRCAISim1: 環境構築方法</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="asrc_doc_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ASRCAISim1
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('a186436.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">環境構築方法 </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_doc_2src_2installation_2installation"></a></p>
<h1 class="doxsection"><a class="anchor" id="section_installation_recommended_environment"></a>
推奨動作環境(主要な項目のみ)</h1>
<p>本シミュレータの推奨動作環境は以下の通りである。</p>
<ul>
<li>OS : Ubuntu 22.04 LTS</li>
<li>Boost : 1.88.0</li>
<li>cereal : 1.3.2</li>
<li>CMake : 3.22.1 (&gt;=3.10)</li>
<li>Doxygen : 1.14.0 (取扱説明書を生成する場合のみ)</li>
<li>Eigen : 3.4.0</li>
<li>gcc : 11.4.0 (C++20)</li>
<li>gymnasium : 0.28.1〜1.0.0 (rayのバージョンに依存する)</li>
<li>Magic Enum C++ : 0.9.7</li>
<li>nlohmann's json : 3.12.0</li>
<li>NLopt : 2.7.1</li>
<li><a class="el" href="a181080.html">pybind11</a> : 2.13.6</li>
<li>Python : 3.10</li>
<li>PyTorch : 2.7.0 (&gt;=2.1.0)</li>
<li>ray[default,tune,rllib] : 2.7.0〜2.46.0</li>
<li>thread-pool : 5.0.0</li>
</ul>
<p>上記のうちC++依存ライブラリの一覧は <a class="el" href="a186435.html">C++依存ライブラリの一覧</a> に記載している。</p>
<h1 class="doxsection"><a class="anchor" id="section_installation_procedure"></a>
インストール方法</h1>
<h2 class="doxsection"><a class="anchor" id="section_installation_python_venv"></a>
Python仮想環境の起動</h2>
<p>　本シミュレータのビルドスクリプトは"python"コマンドでインタプリタを起動する仕様となっている。 そのため、venvやconda等を用いて仮想環境を利用することを推奨する。</p>
<div class="fragment"><div class="line">cd your/path/to/create/virtual/env</div>
<div class="line">python3 -m venv env_name</div>
<div class="line">source env_name/bin/activate</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="section_installation_install_setuptools"></a>
setuptoolsのインストール</h2>
<p>後述のインストール用スクリプトはビルド時にsetuptools&gt;=62.4が必要なため、もし未インストールの場合は事前にインストールしておく。</p>
<div class="fragment"><div class="line">pip install &quot;setuptools&gt;=62.4&quot;</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="section_installation_install_simulator"></a>
シミュレータのビルド・インストール</h2>
<p>リポジトリ直下で、</p>
<div class="fragment"><div class="line">python install_all.py -i -c # 本体部分</div>
<div class="line">python install_all.py -i -p # core_plugins以下に存在するプラグイン全て</div>
<div class="line">python install_all.py -i -u # user_plugins以下に存在するプラグイン全て</div>
<div class="line">#python install_all.py -a #-aは-c -p -uを全て指定するのと同じ効果</div>
</div><!-- fragment --><p>の順に実行すると、本体、core plugin、user pluginの順にビルド・インストールされる。</p>
<h2 class="doxsection"><a class="anchor" id="section_installation_install_deep_learning_framework"></a>
深層学習用フレームワークのインストール</h2>
<p>シミュレータ及びサンプルの全ての機能を使用するためにはPyTorchとTensorflow(Tensorboard)が必要であるため、 各ユーザーは自身の所望のバージョンのこれらのフレームワークを別途インストールしておく必要がある。 なお、PyTorchについては一部のプラグインのrequirementsに含まれているため、未インストールだった場合はpip経由で 自動的にインストールされる。</p>
<h2 class="doxsection"><a class="anchor" id="section_installation_install_sample_for_4th_acac"></a>
第4回空戦AIチャレンジ用サンプルのビルド・インストール</h2>
<p>リポジトリ直下で、-mオプションをつけて</p>
<div class="fragment"><div class="line">python install_all.py -i -m &quot;./sample/modules/R7ContestSample&quot;</div>
</div><!-- fragment --><p>を実行するとR7ContestSampleパッケージがuser pluginとしてインストールされる。</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md0"></a>
ドキュメントの生成</h2>
<h3 class="doxsection"><a class="anchor" id="autotoc_md1"></a>
Doxygenのインストール</h3>
<p>本シミュレータはC++20の機能を使用しているため、Ubuntu 22.04のaptリポジトリから得られるDoxygenでは正しくドキュメントを生成できない。最新版のバイナリをGitHub等からダウンロードしてインストールすること。</p>
<div class="fragment"><div class="line"># graphviz、pdf2svgをインストール</div>
<div class="line">sudo apt-get install -y graphviz pdf2svg</div>
<div class="line"> </div>
<div class="line"># LATEXをインストール</div>
<div class="line">sudo apt-get install -y texlive-ful</div>
<div class="line"> </div>
<div class="line"># LATEXのインストール中に、</div>
<div class="line"># &quot;Pregenerating ConTeXt MarkIV format. This may take some time...&quot;</div>
<div class="line"># というメッセージが出たところで止まってしまうが、</div>
<div class="line"># Enter を連打(長押し)することでインストールが完了する。</div>
<div class="line"> </div>
<div class="line"># Doxygenの最新版のバイナリをダウンロード</div>
<div class="line">curl https://github.com/doxygen/doxygen/releases/download/Release_1_14_0/doxygen-1.14.0.linux.bin.tar.gz -o doxygen-1.14.0.linux.bin.tar.gz -L</div>
<div class="line"> </div>
<div class="line">tar -xf doxygen-1.14.0.linux.bin.tar.gz</div>
<div class="line">cd doxygen-1.14.0</div>
<div class="line">sudo make</div>
<div class="line">sudo make install</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md2"></a>
ドキュメント生成スクリプトの実行</h3>
<p>上記のインストールが完了した後、仮想環境を起動した状態で、以下を実行するとdoc/html以下似ドキュメントが生成され、そのトップページはdoc/html/core/index.htmlとして生成される。</p>
<div class="fragment"><div class="line">bash ./doc/scripts/generate.sh</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="section_installation_install_all_py_options"></a>
install_all.pyのオプション一覧</h2>
<div class="fragment"><div class="line">usage: <a class="code hl_namespace" href="a181116.html">install_all</a>.py [-h] [--clean] [-s] [-b] [-i] [-a] [-c] [-p] [-u] [-m [MANUAL_PATHS ...]] [-o] [-f [FIND_LINKS ...]] [-n] [--debug] [--msys]</div>
<div class="line"> </div>
<div class="line">options:</div>
<div class="line">  -h, --help            show <span class="keyword">this</span> help message and exit</div>
<div class="line">  --clean               use when you want to clean and rebuild</div>
<div class="line">  -s, --sdist           use when you want to generate sdists</div>
<div class="line">  -b, --bdist_wheel     use when you want to generate wheels</div>
<div class="line">  -i, --install         use when you want to install packges</div>
<div class="line">  -a, --all_packages    use when you want to clean and rebuild core package (<a class="code hl_namespace" href="a181091.html">ASRCAISim1</a> itself) and all (core/user) plugins</div>
<div class="line">  -c, --core            use when you want to clean and rebuild core package (<a class="code hl_namespace" href="a181091.html">ASRCAISim1</a> itself)</div>
<div class="line">  -p, --core-plugins    use when you want to clean and rebuild core plugins</div>
<div class="line">  -u, --user-plugins    use when you want to clean and rebuild use plugins</div>
<div class="line">  -m [MANUAL_PATHS ...], --manual-paths [MANUAL_PATHS ...]</div>
<div class="line">                        use when you want to designate paths manually</div>
<div class="line">  -o, --offline         use when you want to build in an offline environment</div>
<div class="line">  -f [FIND_LINKS ...], --find-links [FIND_LINKS ...]</div>
<div class="line">                        use to give the find-links option passed to pip when you are in an offline environment</div>
<div class="line">  -n, --no-build-isolation</div>
<div class="line">                        use when you want not to isolate build environment</div>
<div class="line">  --debug               use when you want to build C++ module as debug mode</div>
<div class="line">  --msys                use when you want to use MSYS</div>
<div class="ttc" id="aa181091_html"><div class="ttname"><a href="a181091.html">ASRCAISim1</a></div><div class="ttdoc">Copyright (c) 2021-2025 Air Systems Research Center, Acquisition, Technology &amp; Logistics Agency(ATLA)</div><div class="ttdef"><b>Definition</b> <a href="a00281_source.html#l00001">__init__.py:1</a></div></div>
<div class="ttc" id="aa181116_html"><div class="ttname"><a href="a181116.html">install_all</a></div><div class="ttdef"><b>Definition</b> <a href="a00704_source.html#l00001">install_all.py:1</a></div></div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="section_installation_check_if_installed_correctly"></a>
動作確認</h1>
<h2 class="doxsection"><a class="anchor" id="section_installation_check_simulator"></a>
シミュレータ本体の動作確認</h2>
<p>sample/scripts/R7Contest/MinimumEvaluationに移動し、</p>
<div class="fragment"><div class="line">python evaluator.py &quot;Rule-Fixed&quot; &quot;Rule-Fixed&quot; -n 1 -v -l &quot;./result&quot;</div>
</div><!-- fragment --><p>を実行すると、オープン部門のシナリオでルールベースの初期行動判断モデルどうしの戦闘が可視化しながら1回行われ、その結果を保存したログが./resultに保存される。GUIの無い環境で使用したい場合は、-vのオプションを省略することで可視化を無効化できる。 ユース部門のシナリオで実行したい場合は-yオプションを指定する。</p>
<h2 class="doxsection"><a class="anchor" id="section_installation_check_HandyRL_sample"></a>
HandyRLを用いた学習のサンプル</h2>
<h3 class="doxsection"><a class="anchor" id="section_installation_check_HandyRL_train"></a>
学習の実施</h3>
<p>sample/scripts/R7Contest/HandyRLSampleに移動し、</p>
<div class="fragment"><div class="line">python main.py R7_contest_open_sample_M.yaml --train</div>
</div><!-- fragment --><p>を実行すると、オープン部門のシナリオで1体で陣営全体を操作する行動判断モデルについて、Self-Playによる学習が行われる。 学習結果は./results/Open/Multi/YYYYmmddHHMMSS以下に保存される。 なお、"M"を"S" に変更すると、1 体で1機を操作する行動判断モデルとなり、保存先は"Multi"の代わりに"Single"となる。 また、ユース部門の場合は上記のopen,Openをyouth,Youthと読み替えること。</p>
<h3 class="doxsection"><a class="anchor" id="section_installation_check_HandyRL_evaluation"></a>
学習済モデルの評価</h3>
<p>学習済モデルは、./results/Open/Multi/YYYYmmddHHMMSS/policies/checkpoints以下に保存されている。 このモデルの評価は上記のevaluator.pyを使用することで可能である。 sample/scripts/R7Contest/MinimumEvaluation/candidates.jsonを開き、例えば</p>
<div class="fragment"><div class="line">&quot;test&quot;:{</div>
<div class="line">    &quot;userModuleID&quot;:&quot;HandyRLSample01M&quot;,</div>
<div class="line">    &quot;args&quot;:{&quot;weightPath&quot;:&quot;&lt;学習済の.pthファイルのフルパス&gt;&quot;}</div>
<div class="line">}</div>
</div><!-- fragment --><p>のように候補を追加し、sample/scripts/R7Contest/MinimumEvaluation上で</p>
<div class="fragment"><div class="line">python evaluator.py &quot;test&quot; &quot;Rule-Fixed&quot; -n 10 -v -l &quot;eval_test.csv&quot;</div>
</div><!-- fragment --><p>と実行すると、初期行動判断モデルとの対戦による学習済モデルの評価を行うことができる。 ユース部門の場合は上記のopen,Openをyouth,Youthと読み替えること。また、-yオプションの指定を忘れないこと。</p>
<h1 class="doxsection"><a class="anchor" id="section_installation_docker_sample"></a>
Dockerコンテナの使用</h1>
<p>dockerディレクトリ以下に、本シミュレータを利用するdockerイメージの構築サンプルを配置している。</p>
<h2 class="doxsection"><a class="anchor" id="section_installation_build_docker_image"></a>
イメージのビルド</h2>
<p>build_docker_image.shを用いる。GUI環境の要否に応じてcli,vnc,xrdpのいずれかをコマンドライン引数に与える。</p>
<div class="fragment"><div class="line">bash build_docker_image.sh [cli|vnc|xrdp]</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="section_installation_run_container"></a>
コンテナの起動</h2>
<p>run_container.shに起動コマンドの例を記述している。</p>
<div class="fragment"><div class="line">bash run_container.sh [cli|vnc|xrdp]</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="section_installation_container_description"></a>
コンテナの中身について</h2>
<p>シミュレータは/opt/data/ASRCAISim1に格納されており、/opt/data/venv/acac_4thにある仮想環境にインストールされている。</p>
<div class="fragment"><div class="line">source /opt/data/venv/acac_4th/bin/activate</div>
</div><!-- fragment --><p>で仮想環境を起動できる。</p>
<h1 class="doxsection"><a class="anchor" id="section_installation_uninstall"></a>
アンインストール方法</h1>
<p>pip uninstallでもよいが、プラグインを一括でアンインストールするためのスクリプトuninstall.pyを用意している。</p>
<div class="fragment"><div class="line">python uninstall_all.py -u # user plugin全て</div>
<div class="line">python uninstall_all.py -p # core plugin全て</div>
<div class="line">python uninstall_all.py -c # 本体部分</div>
<div class="line">#python uninstall_all.py -a #-aは-c -p -uを全て指定するのと同じ効果</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="section_uninstall_all_py_options"></a>
uninstall_all.pyのオプション一覧</h2>
<div class="fragment"><div class="line">usage: <a class="code hl_namespace" href="a181117.html">uninstall_all</a>.py [-h] [-a] [-c] [-p] [-u]</div>
<div class="line"> </div>
<div class="line">options:</div>
<div class="line">  -h, --help          show <span class="keyword">this</span> help message and exit</div>
<div class="line">  -a, --all_packages  use when you want to clean and rebuild core package (<a class="code hl_namespace" href="a181091.html">ASRCAISim1</a> itself) and all (core/user) plugins</div>
<div class="line">  -c, --core          use when you want to clean and rebuild core package (<a class="code hl_namespace" href="a181091.html">ASRCAISim1</a> itself)</div>
<div class="line">  -p, --core-plugins  use when you want to clean and rebuild core plugins</div>
<div class="line">  -u, --user-plugins  use when you want to clean and rebuild use plugins</div>
<div class="ttc" id="aa181117_html"><div class="ttname"><a href="a181117.html">uninstall_all</a></div><div class="ttdef"><b>Definition</b> <a href="a00350_source.html#l00001">uninstall_all.py:1</a></div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
