<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ASRCAISim1: 座標系の取り扱いについて</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="asrc_doc_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ASRCAISim1
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('a186445.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">座標系の取り扱いについて </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>座標参照系(Coorinate Reference System: CRS)とは、測地学や天文学で用いられる、 物理空間上(特に地球上)の位置関係を記述するための概念である。 CRSの概念を実空間での測量等により実現した座標系をCoordinate Reference Frame、 原点と座標軸の組み合わせを単にCoordinate Systemと呼び分けることもあるが、 これらを区別せずとも実用上特段の支障はないため、 本シミュレータにおいては必要がない限りこれらを区別せず単に座標系と呼称し、 クラス名や変数名はCRSの語を用いるものとする。</p>
<h1 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_hierarchy"></a>
座標系の分類とクラス階層</h1>
<p>CRSを表す基底クラスは <a class="el" href="a182064.html" title="座標系を表す基底クラス">CoordinateReferenceSystem</a> であり、 <a class="el" href="a182168.html" title="Factory により生成・管理されるオブジェクトの基底クラス。">Entity</a> の派生クラスとして実装している。 本来CRSはシミュレーション登場物とは言い難いものの、 <a class="el" href="a182196.html" title="Entityの生成を行うクラス。">Factory</a> や <a class="el" href="a182596.html" title="gymnasium(OpenAI gym)のEnvとしてのインターフェースを持ったシミュレーション実行管理クラスの具象クラス。">SimulationManager</a> による生成・管理の利便性のためにこのような実装としているものである。</p>
<p><a class="el" href="a182064.html" title="座標系を表す基底クラス">CoordinateReferenceSystem</a> は以下のように分類される。</p>
<div class="fragment"><div class="line">CoordinateReferenceSystem</div>
<div class="line">├ GeodeticCRS</div>
<div class="line">│├ GeographicCRS</div>
<div class="line">│└ EarthCenteredInertialCRS</div>
<div class="line">├ PureFlatCRS</div>
<div class="line">└ DerivedCRS</div>
<div class="line">　├ AffineCRS</div>
<div class="line">　├ TopocentricCRS</div>
<div class="line">　└ ProjectedCRS</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_GeodeticCRS"></a>
GeodeticCRS</h2>
<p><a class="el" href="a182080.html" title="地球を中心とした座標系を表すクラス。">GeodeticCRS</a> クラスは地球を中心とした座標系を表す。本シミュレータではGeocentric (ECEF)、Geographic (測地座標系)、Earth Centered Inertial (ECI)の3種類に分けて扱う。 ISO 19111のクラス階層に準じて、基底クラスとなる <a class="el" href="a182080.html" title="地球を中心とした座標系を表すクラス。">GeodeticCRS</a> のインスタンスはECEF座標系を表すものとし、その派生クラスとして <a class="el" href="a182084.html" title="緯度、経度、高度で位置を表現する測地座標系を表すCRS。">GeographicCRS</a> クラスと EarthCenteredInertialCRS クラスを実装する。</p>
<p>同種の <a class="el" href="a182080.html" title="地球を中心とした座標系を表すクラス。">GeodeticCRS</a> であっても、そのインスタンス(<a class="el" href="a182028.html" title="ある座標系上の特定時刻における座標値を管理するクラス">Coordinate</a> Reference Frameに相当)は一意ではないことに留意されたい。 地球の中心や形状、自転軸の定義は様々な年代の様々な測量結果に基づく定義が存在しているためである。 具体例としてはGPS衛星で用いられているWGS84や、国際標準として数年おきに定義されるITRFが挙げられる。</p>
<p>ECEF座標系と測地座標系が地球に固定され地球とともに回転するのに対し、 ECI座標系は原点を地球の中心に固定しながらも座標軸は星々に対し固定される。 そのため、ECI座標系は測地学ではなく天文学で利用される。 工学的には人工衛星のような宇宙機の運動を記述する際に用いられることが多い。 ECI座標系の具体例としては、J2000.0を元期とするMEME2000 (Mean Equator Mean Equinox 2000)や、 国際標準として定義されたICRF (International Celestial Reference Frame)が挙げられる。</p>
<p>運動の基準としてECIとECEFのどちらを用いるのが適しているかについては用途によって異なる。 ECIは実質的に慣性系とみなせるためコリオリの力等の慣性力を考慮しなくてよい一方で、 いわゆる重力(gravity)は万有引力(gravitation)のみでなく自転による遠心力(centrifugal force)の 影響も含んだものとして扱われるため、実測データに基づく重力場モデル(EGM等)を用いる場合には 遠心力の影響を減算する必要が生じる。 他方、ECEFは自転に起因するコリオリの力を考慮しなければならない一方で、EGM等の重力場モデルをそのまま使用できる。 本シミュレータでは、地球に固定された座標系(ECEF)の方を基準座標系として扱う。</p>
<h3 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_GeodeticCRS_limitation"></a>
制約</h3>
<p>本シミュレータの本体部分としては、以下の制約を有する。これらは必要に応じてPROJ等の外部ライブラリを用いたプラグインとして実装する想定である。</p>
<ul>
<li>楕円体形状、原点位置、座標軸の向きが異なる <a class="el" href="a182080.html" title="地球を中心とした座標系を表すクラス。">GeodeticCRS</a> 間の座標変換は不可</li>
<li><a class="el" href="a182084.html" title="緯度、経度、高度で位置を表現する測地座標系を表すCRS。">GeographicCRS</a> の緯度と経度はつねに緯度が先、単位はradianのみ</li>
<li>ECIの具象クラスは一例として楕円体中心を通る南北極方向を軸に等速で自転するもののみ</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_PureFlatCRS"></a>
PureFlatCRS</h2>
<p><a class="el" href="a182124.html" title="仮想的な水平な慣性座標系を表すクラス">PureFlatCRS</a> クラスは、地球の曲率を無視して仮想的な平面とみなす座標系を表す。 ISO 19111におけるEngineeringCRSに相当し、簡易モデルを用いた要素技術の検討などに用いられる。</p>
<h2 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_DerivedCRS"></a>
DerivedCRS</h2>
<p><a class="el" href="a182072.html" title="ある親座標系基準の相対的な座標系を表すCRS">DerivedCRS</a> クラスは、他の座標系を親として親座標系から何らかの座標変換を行うことで得られる座標系である。 ISO 19111においてもDerivedCRSとして定義されている。本シミュレータでは以下の3種類のDerivedCRSを派生クラスとして定義する。</p>
<p><a class="el" href="a182072.html" title="ある親座標系基準の相対的な座標系を表すCRS">DerivedCRS</a> クラスのインスタンスを生成する際には、親となるCRSの情報を指定する必要がある。 親となるCRSの情報は、 instanceConfig["base"]に <a class="el" href="a186448.html#section_simulation_entity_creation_format">EntityManager::createOrGetEntityに渡せる形式</a>で指定する。必ずしも既存のインスタンスを指す必要はなく、新たなインスタンスを生成してそれを親とすることも可能である。</p>
<h3 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_AffineCRS"></a>
AffineCRS</h3>
<p><a class="el" href="a182056.html" title="ある親座標系基準でアフィン変換により得られる相対的な座標系を表すCRS">AffineCRS</a> クラスは、親CRS上のある点が原点となるように平行移動し、 さらに座標軸を回転させることで得られる座標系を表す。</p>
<p>本シミュレータの実装においては、親CRSに固定されたものに限らず、原点の平行移動の速度と座標軸回転の角速度の情報を持つものとする。 なお、軸の拡大・縮小は伴わないものとする。</p>
<p><a class="el" href="a182056.html" title="ある親座標系基準でアフィン変換により得られる相対的な座標系を表すCRS">AffineCRS</a> の移動と回転を許容することにより、物体に固定された座標系は <a class="el" href="a182056.html" title="ある親座標系基準でアフィン変換により得られる相対的な座標系を表すCRS">AffineCRS</a> として表現できる。本シミュレータでは <a class="el" href="a182056.html" title="ある親座標系基準でアフィン変換により得られる相対的な座標系を表すCRS">AffineCRS</a> の諸元を、物体の運動状態を表すデータ型<a class="el" href="a186454.html">MotionState</a>を用いて表現する。 また、逆に<a class="el" href="a186454.html">MotionState</a>をそれに相当する <a class="el" href="a182056.html" title="ある親座標系基準でアフィン変換により得られる相対的な座標系を表すCRS">AffineCRS</a> とみなして様々な座標変換を行うメンバ関数を <a class="el" href="a186454.html">MotionState</a> クラスに実装している( <a class="el" href="a182368.html#a15ecc67f3b33b3a3932cf50adaf0e078" title="parent系⇛self系">MotionState::absPtoB</a> 等)。</p>
<p>ユーザは必ずしも <a class="el" href="a182056.html" title="ある親座標系基準でアフィン変換により得られる相対的な座標系を表すCRS">AffineCRS</a> インスタンスを明示的に生成する必要はなく、基本的には <a class="el" href="a182384.html" title="Asset のうち物理的実体を持つものを表すクラス">PhysicalAsset</a> が持つ <a class="el" href="a182368.html" title="あるPhysicalAssetの運動状態を保持するクラス">MotionState</a> の座標変換関数を呼ぶことで事足りることが多い。 なお、 <a class="el" href="a182368.html" title="あるPhysicalAssetの運動状態を保持するクラス">MotionState</a> の情報は <a class="el" href="a182384.html" title="Asset のうち物理的実体を持つものを表すクラス">PhysicalAsset</a> の <a class="el" href="a181980.html#a082747f91819981dc750430ac6f746ad">observables</a>としても出力される。</p>
<h3 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_TopocentricCRS"></a>
TopocentricCRS</h3>
<p><a class="el" href="a182132.html" title="局所水平座標系(通常はENU又はNED)を表すCRS">TopocentricCRS</a> クラスは局所水平座標系を表す。正確には、地球楕円体面の法線方向を一つの座標軸として持つ直交座標系である。 原点の位置は地表面(楕円体表面)とする場合と、特定の高度に置く場合がある。</p>
<p><a class="el" href="a182132.html" title="局所水平座標系(通常はENU又はNED)を表すCRS">TopocentricCRS</a> の用途を考えると原点は時間とともに移動させたいことが多く、また原点位置と座標軸を指定すれば一意に定まるため、 本シミュレータでは必ずしも明示的に <a class="el" href="a182132.html" title="局所水平座標系(通常はENU又はNED)を表すCRS">TopocentricCRS</a> インスタンスを生成せずとも、任意の <a class="el" href="a182064.html" title="座標系を表す基底クラス">CoordinateReferenceSystem</a> インスタンスのメンバ関数 <a class="el" href="a182064.html#abe951cbaf5504ccc3c87dbd98794dd8e">transformToTopocentricCRS</a>と<a class="el" href="a182064.html#a13b2412486a80d232dcefb0cf2905bc2">transformFromTopocentricCRS</a>を 使用することで座標変換を行えるようになっている。</p>
<p>また、<a class="el" href="a186454.html">MotionState</a>クラスにも <a class="el" href="a182132.html" title="局所水平座標系(通常はENU又はNED)を表すCRS">TopocentricCRS</a> との座標変換を <a class="el" href="a182132.html" title="局所水平座標系(通常はENU又はNED)を表すCRS">TopocentricCRS</a> インスタンスを生成せずに行うメンバ関数を実装している( <a class="el" href="a182368.html#aa539f976a104bededd5d59638d9f5d00" title="parent系⇛horizontal系">MotionState::absPtoH</a> 等。)</p>
<h3 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_ProjectedCRS"></a>
ProjectedCRS</h3>
<p><a class="el" href="a182108.html" title="2次元平面に投影された座標系(UTMなど)を表すクラス">ProjectedCRS</a> クラスは、親となる <a class="el" href="a182080.html" title="地球を中心とした座標系を表すクラス。">GeodeticCRS</a> の緯度経度を平面上の2次元座標に 変換するものであり、高度はそのまま据え置きとなる。 例えばメルカトル図法により投影された座標系等が該当する。</p>
<p><a class="el" href="a182108.html" title="2次元平面に投影された座標系(UTMなど)を表すクラス">ProjectedCRS</a> は投影図法によって座標軸の直交性や縮尺が場所によって異なるため、他の CRSに比べて「絶対位置」以外の座標変換の取り扱いが難しくなる。</p>
<p>本シミュレータの本体部分としては <a class="el" href="a182108.html" title="2次元平面に投影された座標系(UTMなど)を表すクラス">ProjectedCRS</a> の一例として、 任意の経度を原点とするユニバーサル横メルカトル図法のみを実装している。 他の図法が必要な場合は、PROJ等の外部ライブラリを用いたプラグインとして実装する想定である。</p>
<h1 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_axis_order"></a>
座標軸の順序について</h1>
<p>座標系を定めたとしても、3次元ベクトル値として座標値を表現する際には どの向きに基底(座標軸)を取るかの自由度がある。</p>
<p>本シミュレータにおける座標軸の順序は以下のとおりとする。</p>
<h2 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_axis_geodetic"></a>
GeodeticCRS の場合</h2>
<p>ECEF座標系の場合、楕円体中心を原点として、 赤道面上の経度0度方向を+x軸、東経90度方向を+y軸、北極方向を+z軸とする。</p>
<p>測地座標系の場合、緯度、経度、高度の順とする。 ただし、緯度は測地系緯度(楕円体表面における法線と赤道面のなす角度)とする。</p>
<p>ECI座標系の場合、ある基準時刻(元期)におけるECEF座標系の座標軸を自身の座標軸として用いる。</p>
<h2 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_axis_body_cartesian"></a>
物体固定座標系の直交座標軸の場合</h2>
<p>以下の3種類の軸を表す文字を一つずつ含む3文字の文字列で表現するものとする。 (例："FSD"…前が+x、右が+y、下が+z)</p>
<ol type="1">
<li>前後方向<ul>
<li>'F' FWD 前方が正の軸</li>
<li>'A' AFT 後方が正の軸</li>
</ul>
</li>
<li>左右方向<ul>
<li>'S' STBD(RIGHT) 右方が正の軸</li>
<li>'R' RIGHT 右方が正の軸</li>
<li>'P' PORT(LEFT) 左方が正の軸</li>
<li>'L' LEFT 左方が正の軸</li>
</ul>
</li>
<li>上下方向<ul>
<li>'U' UP 上方が正の軸</li>
<li>'D' DOWN 下方が正の軸</li>
</ul>
</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_axis_topocentric_cartesian"></a>
局所水平座標系の直交座標軸の場合</h2>
<p>以下の3種類の軸を表す文字を一つずつ含む3文字の文字列で表現するものとする。 (例："NED"…北が+x、東が+y、下が+z)</p>
<ol type="1">
<li>南北方向<ul>
<li>'N' North 北が正の軸</li>
<li>'S' South 南が正の軸</li>
</ul>
</li>
<li>東西方向<ul>
<li>'E' East 東が正の軸</li>
<li>'W' West 西が正の軸</li>
</ul>
</li>
<li>上下方向<ul>
<li>'U' UP 鉛直上方が正の軸</li>
<li>'D' DOWN 鉛直下方が正の軸</li>
</ul>
</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_axis_spherical"></a>
球座標系の場合</h2>
<p>以下の3種類の軸を表す文字を一つずつ含む3文字の文字列で表現するものとする。 (例："AER"…経度方向、緯度方向、距離の順)</p>
<p>ただし、経度方向の符号は対応する直交座標系の+x-y平面上で+x軸方向を0として+y軸側を正とし、 緯度方向の符号は対応する直交座標系のx-y平面上を0として+z軸側を正とする。</p>
<ol type="1">
<li>経度方向<ul>
<li>'A' Azimuth</li>
</ul>
</li>
<li>緯度方向<ul>
<li>'E' Elevation</li>
</ul>
</li>
<li>距離(以下のいずれか。意味は同じ)<ul>
<li>'D' Distance</li>
<li>'R' Range</li>
</ul>
</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_CoordinateType"></a>
座標値の種類</h1>
<p>本シミュレータにおいて、座標値の種類は以下の5種類を定義しており、 <a class="el" href="a181078.html#ad7dd1c0193f6d8ce4b40d3d5c5e76651" title="座標の種類を表す列挙体。">CoordinateType</a> 列挙体として表現する。 互いに固定されていない座標系の間での座標変換や、正規直交基底を持たない座標系との間の座標変換等は、 この座標値の種類によって、異なる変換式が用いられる。</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">値  </th><th class="markdownTableHeadNone">意味  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">POSITION_ABS  </td><td class="markdownTableBodyNone">絶対位置。原点からの変位を表す。  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">POSITION_REL  </td><td class="markdownTableBodyNone">相対位置。ある点から別の点への相対的な変位を表す。  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">DIRECTION  </td><td class="markdownTableBodyNone">方向。ある点から別の点への方向を表す。  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">VELOCITY  </td><td class="markdownTableBodyNone">並進速度。  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ANGULAR_VELOCITY  </td><td class="markdownTableBodyNone">角速度。  </td></tr>
</table>
<p>例えば、二つの座標系の原点が異なる場所にある場合、 POSITION_ABSの変換では原点位置の差分を加算する必要があるが POSITION_RELやDIRECTIONの変換では不要である。</p>
<p>また、二つの座標系の原点が互いに移動している場合、 VELOCITYの変換ではその移動速度を加算する必要がある。</p>
<p>また、二つの座標系が互いに回転している場合、 ANGULAR_VELOCITYの変換ではその回転角速度を加算する必要があり、 VELOCITYの変換では一方から見た他方の原点の見かけの移動速度を加算する必要がある。</p>
<h1 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_CRS_transformation"></a>
CoordinateReferenceSystem オブジェクトを用いた座標変換</h1>
<p><a class="el" href="a182064.html" title="座標系を表す基底クラス">CoordinateReferenceSystem</a> 及びその派生クラスでは、様々な引数をとる様々な座標変換関数が実装されている。</p>
<p>ただし、 <a class="el" href="a182064.html" title="座標系を表す基底クラス">CoordinateReferenceSystem</a> クラスのメンバ関数以外にも、 <a class="el" href="#section_simulation_Coordinate_Coordinate_transformation">Coordinate</a>、 <a class="el" href="a186454.html#section_simulation_MotionState_transformation">MotionState</a>、 <a class="el" href="a186457.html#section_simulation_Track_transformation">Track</a>といったデータクラスにも座標変換用の関数が提供されており、 多くの場合はこれらのデータクラスの関数を使用する方が簡便であるため、 <a class="el" href="a182064.html" title="座標系を表す基底クラス">CoordinateReferenceSystem</a> の座標変換関数に関する個別の詳細説明は割愛する。</p>
<h1 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_Coordinate"></a>
座標値を表すデータ型「 Coordinate 」</h1>
<p>異なる座標系の間で座標変換を適切に行うためには、座標値を表すベクトル一つでは情報が不足する。 その座標値が観測された位置と時刻、及び<a class="el" href="#section_simulation_Coordinate_CoordinateType">座標値の種類</a>によって、変換式が異なる。</p>
<p>本シミュレータでは、座標変換に必要な情報を保持したデータ型として <a class="el" href="a182028.html" title="ある座標系上の特定時刻における座標値を管理するクラス">Coordinate</a> クラスを実装しており、絶対位置、相対位置、方向、並進速度、角速度の5種類の座標値に関する座標変換機能を提供している。</p>
<h2 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_Coordinate_json"></a>
Coordinate クラスのjson表現</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">key  </th><th class="markdownTableHeadNone">value  </th><th class="markdownTableHeadNone">load時の省略可否  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">value  </td><td class="markdownTableBodyNone">座標値(3次元ベクトル)  </td><td class="markdownTableBodyNone">不可  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">location  </td><td class="markdownTableBodyNone">観測された点の座標値(絶対位置)  </td><td class="markdownTableBodyNone">不可  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">crs  </td><td class="markdownTableBodyNone"><a class="el" href="a186455.html#section_simulation_Entity_as_reference_json">CRSのjson表現</a>  </td><td class="markdownTableBodyNone">不可  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">time  </td><td class="markdownTableBodyNone">時刻 (<a class="el" href="a182764.html" title="時刻系の情報と合わせて時刻情報を表現するための構造体。">Time</a>)  </td><td class="markdownTableBodyNone">不可  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">type  </td><td class="markdownTableBodyNone">座標の種類(<a class="el" href="a181078.html#ad7dd1c0193f6d8ce4b40d3d5c5e76651" title="座標の種類を表す列挙体。">CoordinateType</a> を表す文字列)  </td><td class="markdownTableBodyNone">不可  </td></tr>
</table>
<h2 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_Coordinate_transformation"></a>
Coordinate オブジェクトの座標変換</h2>
<p><a class="el" href="a182028.html" title="ある座標系上の特定時刻における座標値を管理するクラス">Coordinate</a> オブジェクトは以下のように、 <a class="el" href="a182028.html#aa2b7261c67bb817dba160e6cc5520a81">operator(crs)</a>や <a class="el" href="a182028.html#a55bcdcc538d75bf65a5dada2823d74bd">transformTo(crs)</a>によって 特定の座標系での値に容易に変換することができる。</p>
<div class="fragment"><div class="line">std::shared_ptr&lt;CoordinateReferenceSystem&gt; crs=manager-&gt;getRootCRS(); <span class="comment">// 変換先の座標系</span></div>
<div class="line">Coordinate c; <span class="comment">// 何らかの座標</span></div>
<div class="line">Eigen::Vector3d p=c(crs); <span class="comment">// crsにおける座標ベクトルとして取得</span></div>
<div class="line">Eigen::Vector3d p=c(); <span class="comment">// 引数を省略した場合はcが元々保持していた座標系における座標ベクトルとして取得</span></div>
<div class="line"> </div>
<div class="line">Coordinate c2=c.transformTo(crs); <span class="comment">// crsにおける新たな Coordinate オブジェクトとして取得</span></div>
</div><!-- fragment --> <div class="fragment"><div class="line">crs=self.manager.getRootCRS() <span class="comment"># 変換先の座標系</span></div>
<div class="line">t=Coordinate() <span class="comment"># 何らかの座標</span></div>
<div class="line">p=c(crs) <span class="comment"># crsにおける座標ベクトルをnp.ndarrayとして取得</span></div>
<div class="line">p=c() <span class="comment"># 引数を省略した場合はcが元々保持していた座標系における座標ベクトルとして取得</span></div>
<div class="line"> </div>
<div class="line">c2=c.transformTo(crs) <span class="comment"># crsにおける新たな Coordinate オブジェクトとして取得</span></div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_preset_models"></a>
CRSモデルのプリセット</h1>
<p>ASRCAISim1/config/CoordinateReferenceSystem.json に 幾つかの基本的なCRSモデルが以下のとおり定義済である。</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">モデル名  </th><th class="markdownTableHeadNone">概要  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Flat_NED  </td><td class="markdownTableBodyNone">North-East-Downの座標軸を持った <a class="el" href="a182124.html" title="仮想的な水平な慣性座標系を表すクラス">PureFlatCRS</a> 。原点の地理座標を日本経緯度原点としている。  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Flat_ENU  </td><td class="markdownTableBodyNone">East-North-Upの座標軸を持った <a class="el" href="a182124.html" title="仮想的な水平な慣性座標系を表すクラス">PureFlatCRS</a> 。原点はFlat_NEDと同じ。  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">WGS84_geocentric  </td><td class="markdownTableBodyNone">WGS84楕円体を用いたECEF座標系  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">WGS84_geographic  </td><td class="markdownTableBodyNone">WGS84楕円体を用いた地理座標系  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ITRF94_geocentric  </td><td class="markdownTableBodyNone">ITRF94楕円体を用いたECEF座標系  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ITRF94_geographic  </td><td class="markdownTableBodyNone">ITRF94楕円体を用いた地理座標系  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Topocentric_Japan_NED  </td><td class="markdownTableBodyNone">日本経緯度原点における局所水平座標系(North-East-Down)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Topocentric_Japan_ENU  </td><td class="markdownTableBodyNone">日本経緯度原点における局所水平座標系(East-North-Up)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">UTM_Zone53N_ENU  </td><td class="markdownTableBodyNone">ユニバーサル横メルカトル図法ゾーン53Nで座標軸をNorth-East-Downにとったもの  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">UTM_Zone53N_NED  </td><td class="markdownTableBodyNone">ユニバーサル横メルカトル図法ゾーン53Nで座標軸をEast-North-Upにとったもの  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">UTM_Japan_ENU_local  </td><td class="markdownTableBodyNone">日本経緯度原点を基準経度としたユニバーサル横メルカトル図法で原点を日本経緯度原点にとったもの(East-North-Up)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">UTM_Japan_NED_local  </td><td class="markdownTableBodyNone">日本経緯度原点を基準経度としたユニバーサル横メルカトル図法で原点を日本経緯度原点にとったもの(North-East-Down)  </td></tr>
</table>
<div class="fragment"><div class="line">{&quot;Factory&quot;:{</div>
<div class="line">    &quot;CoordinateReferenceSystem&quot;:{</div>
<div class="line">        &quot;Flat_NED&quot;:{</div>
<div class="line">            &quot;class&quot;:&quot;PureFlatCRS&quot;,</div>
<div class="line">            &quot;config&quot;:{</div>
<div class="line">                &quot;axisOrder&quot;:&quot;NED&quot;,</div>
<div class="line">                &quot;ellipsoidalOrigin&quot;:[</div>
<div class="line">                    35.65809922222222,</div>
<div class="line">                    139.7413574722222,</div>
<div class="line">                    0.0</div>
<div class="line">                ]</div>
<div class="line">            }</div>
<div class="line">        },</div>
<div class="line">        &quot;Flat_ENU&quot;:{</div>
<div class="line">            &quot;class&quot;:&quot;PureFlatCRS&quot;,</div>
<div class="line">            &quot;config&quot;:{</div>
<div class="line">                &quot;axisOrder&quot;:&quot;ENU&quot;,</div>
<div class="line">                &quot;ellipsoidalOrigin&quot;:[</div>
<div class="line">                    35.65809922222222,</div>
<div class="line">                    139.7413574722222,</div>
<div class="line">                    0.0</div>
<div class="line">                ]</div>
<div class="line">            }</div>
<div class="line">        },</div>
<div class="line">        &quot;WGS84_geocentric&quot;: {</div>
<div class="line">            &quot;class&quot;: &quot;GeodeticCRS&quot;,</div>
<div class="line">            &quot;config&quot;: {</div>
<div class="line">                &quot;semiMajorAxis&quot;: 6378137.0,</div>
<div class="line">                &quot;inverseFlattening&quot;: 298.257223563,</div>
<div class="line">                &quot;projString&quot;: &quot;EPSG:4978&quot;</div>
<div class="line">            }</div>
<div class="line">        },</div>
<div class="line">        &quot;WGS84_geographic&quot;: {</div>
<div class="line">            &quot;class&quot;: &quot;GeographicCRS&quot;,</div>
<div class="line">            &quot;config&quot;: {</div>
<div class="line">                &quot;semiMajorAxis&quot;: 6378137.0,</div>
<div class="line">                &quot;inverseFlattening&quot;: 298.257223563,</div>
<div class="line">                &quot;projString&quot;: &quot;EPSG:4979&quot;</div>
<div class="line">            }</div>
<div class="line">        },</div>
<div class="line">        &quot;ITRF94_geocentric&quot;: {</div>
<div class="line">            &quot;class&quot;: &quot;GeodeticCRS&quot;,</div>
<div class="line">            &quot;config&quot;: {</div>
<div class="line">                &quot;semiMajorAxis&quot;: 6378137.0,</div>
<div class="line">                &quot;inverseFlattening&quot;: 298.257222101,</div>
<div class="line">                &quot;projString&quot;: &quot;EPSG:4916&quot;</div>
<div class="line">            }</div>
<div class="line">        },</div>
<div class="line">        &quot;ITRF94_geographic&quot;: {</div>
<div class="line">            &quot;class&quot;: &quot;GeographicCRS&quot;,</div>
<div class="line">            &quot;config&quot;: {</div>
<div class="line">                &quot;semiMajorAxis&quot;: 6378137.0,</div>
<div class="line">                &quot;inverseFlattening&quot;: 298.257222101,</div>
<div class="line">                &quot;projString&quot;: &quot;EPSG:7906&quot;</div>
<div class="line">            }</div>
<div class="line">        },</div>
<div class="line">        &quot;Topocentric_Japan_NED&quot;: {</div>
<div class="line">            &quot;class&quot;: &quot;TopocentricCRS&quot;,</div>
<div class="line">            &quot;config&quot;:{</div>
<div class="line">                &quot;axisOrder&quot;: &quot;NED&quot;,</div>
<div class="line">                &quot;ellipsoidalOrigin&quot;:[</div>
<div class="line">                    35.65809922222222,</div>
<div class="line">                    139.7413574722222,</div>
<div class="line">                    0.0</div>
<div class="line">                ]</div>
<div class="line">            }</div>
<div class="line">        },</div>
<div class="line">        &quot;Topocentric_Japan_ENU&quot;: {</div>
<div class="line">            &quot;class&quot;: &quot;TopocentricCRS&quot;,</div>
<div class="line">            &quot;config&quot;:{</div>
<div class="line">                &quot;axisOrder&quot;: &quot;ENU&quot;,</div>
<div class="line">                &quot;ellipsoidalOrigin&quot;:[</div>
<div class="line">                    35.65809922222222,</div>
<div class="line">                    139.7413574722222,</div>
<div class="line">                    0.0</div>
<div class="line">                ]</div>
<div class="line">            }</div>
<div class="line">        },</div>
<div class="line">        &quot;UTM_Zone53N_ENU&quot;: {</div>
<div class="line">            &quot;class&quot;: &quot;GenericUTMCRS&quot;,</div>
<div class="line">            &quot;config&quot;:{</div>
<div class="line">                &quot;axisOrder&quot;:&quot;ENU&quot;,</div>
<div class="line">                &quot;scaleFactor&quot;:0.9996,</div>
<div class="line">                &quot;onSurface&quot;:true,</div>
<div class="line">                &quot;zone&quot;:53,</div>
<div class="line">                &quot;offset&quot;:[500000.0,0.0,0.0],</div>
<div class="line">                &quot;projectionAsLocal&quot;:false,</div>
<div class="line">                &quot;offsetAsLocal&quot;:false</div>
<div class="line">            }</div>
<div class="line">        },</div>
<div class="line">        &quot;UTM_Zone53N_NED&quot;: {</div>
<div class="line">            &quot;class&quot;: &quot;GenericUTMCRS&quot;,</div>
<div class="line">            &quot;config&quot;:{</div>
<div class="line">                &quot;axisOrder&quot;:&quot;NED&quot;,</div>
<div class="line">                &quot;scaleFactor&quot;:0.9996,</div>
<div class="line">                &quot;onSurface&quot;:true,</div>
<div class="line">                &quot;zone&quot;:53,</div>
<div class="line">                &quot;offset&quot;:[0.0,500000.0,0.0],</div>
<div class="line">                &quot;projectionAsLocal&quot;:false,</div>
<div class="line">                &quot;offsetAsLocal&quot;:false</div>
<div class="line">            }</div>
<div class="line">        },</div>
<div class="line">        &quot;UTM_Japan_ENU_local&quot;: {</div>
<div class="line">            &quot;class&quot;: &quot;GenericUTMCRS&quot;,</div>
<div class="line">            &quot;config&quot;:{</div>
<div class="line">                &quot;axisOrder&quot;:&quot;ENU&quot;,</div>
<div class="line">                &quot;scaleFactor&quot;:0.9996,</div>
<div class="line">                &quot;onSurface&quot;:true,</div>
<div class="line">                &quot;origin&quot;:[</div>
<div class="line">                    35.65809922222222,</div>
<div class="line">                    139.7413574722222,</div>
<div class="line">                    0.0</div>
<div class="line">                ],</div>
<div class="line">                &quot;projectionAsLocal&quot;:true,</div>
<div class="line">                &quot;offsetAsLocal&quot;:true</div>
<div class="line">            }</div>
<div class="line">        },</div>
<div class="line">        &quot;UTM_Japan_NED_local&quot;: {</div>
<div class="line">            &quot;class&quot;: &quot;GenericUTMCRS&quot;,</div>
<div class="line">            &quot;config&quot;:{</div>
<div class="line">                &quot;axisOrder&quot;:&quot;NED&quot;,</div>
<div class="line">                &quot;scaleFactor&quot;:0.9996,</div>
<div class="line">                &quot;onSurface&quot;:true,</div>
<div class="line">                &quot;origin&quot;:[</div>
<div class="line">                    35.65809922222222,</div>
<div class="line">                    139.7413574722222,</div>
<div class="line">                    0.0</div>
<div class="line">                ],</div>
<div class="line">                &quot;projectionAsLocal&quot;:true,</div>
<div class="line">                &quot;offsetAsLocal&quot;:true</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_preset_instances"></a>
SimulationManager固有のCRSインスタンスのプリセット</h2>
<p><a class="el" href="a182596.html" title="gymnasium(OpenAI gym)のEnvとしてのインターフェースを持ったシミュレーション実行管理クラスの具象クラス。">SimulationManager</a> に与えるコンフィグの"/Manager/crs/preset"に、 起動時に生成するCRSインスタンスの一覧を指定することができる。</p>
<p>entityFullNameにはキー名、isEpisodicにはfalse、baseNameには"CoordinateReferenceSystem"が自動的に設定されるため、これらを記述する必要はない。</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;Manager&quot;:{</div>
<div class="line">        &quot;crs&quot;: {</div>
<div class="line">            &quot;preset&quot;: {</div>
<div class="line">                &quot;geoc&quot;: {</div>
<div class="line">                    &quot;modelName&quot;:&quot;WGS84_geocentric&quot;</div>
<div class="line">                },</div>
<div class="line">                &quot;geog&quot;: {</div>
<div class="line">                    &quot;modelName&quot;:&quot;WGS84_geographic&quot;,</div>
<div class="line">                    &quot;instanceConfig&quot;: {</div>
<div class="line">                        &quot;ecef&quot;: {</div>
<div class="line">                            &quot;entityFullName&quot;:&quot;geoc&quot;</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                },</div>
<div class="line">                &quot;local&quot;:{</div>
<div class="line">                    &quot;modelName&quot;:&quot;UTM_Japan_NED_local&quot;,</div>
<div class="line">                    &quot;instanceConfig&quot;:{</div>
<div class="line">                        &quot;base&quot;:{&quot;entityFullName&quot;:&quot;geog&quot;},</div>
<div class="line">                        &quot;origin&quot;:[</div>
<div class="line">                            35.65809922222222,</div>
<div class="line">                            139.7413574722222,</div>
<div class="line">                            0.0</div>
<div class="line">                        ]</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_in_simulation"></a>
シミュレーション中に必ず定義される座標系</h1>
<h2 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_in_simulation_rootCRS"></a>
SimulationManager::rootCRS</h2>
<p>シミュレーション中の基準座標系は <a class="el" href="a182588.html#acff2929b5b8b28b097f07a8539ca642f" title="シミュレーション中の基準座標系。直交座標軸を持つ PureFlatCRS 、 ECEF 又は ECI のいずれかとする。">SimulationManager::rootCRS</a> として <a class="el" href="a182596.html" title="gymnasium(OpenAI gym)のEnvとしてのインターフェースを持ったシミュレーション実行管理クラスの具象クラス。">SimulationManager</a> クラスが保持する。 これは <a class="el" href="a182588.html#a74387861d33b97048d4089ce5c1ac356" title="基準座標系を返す。">SimulationManager::getRootCRS()</a> によって取得可能であり、<a class="el" href="a186441.html#section_simulation_accessor_SimulationManager">SimulationManagerのAccessor</a> からも同名のメンバ関数により取得可能である。</p>
<p>rootCRS は運動方程式の計算等にも用いられるため、直交座標軸を持つ <a class="el" href="a182124.html" title="仮想的な水平な慣性座標系を表すクラス">PureFlatCRS</a> 、 ECEF 、 又は ECI のいずれかとする。</p>
<p>rootCRSの設定は <a class="el" href="a182596.html" title="gymnasium(OpenAI gym)のEnvとしてのインターフェースを持ったシミュレーション実行管理クラスの具象クラス。">SimulationManager</a> に与えるコンフィグの"/Manager/crs/root"に記述する。省略時は NEDの座標軸を持つ <a class="el" href="a182124.html" title="仮想的な水平な慣性座標系を表すクラス">PureFlatCRS</a> が自動生成される。</p>
<ul>
<li>(例1) <a class="el" href="a182196.html" title="Entityの生成を行うクラス。">Factory</a> モデルを指定する場合</li>
</ul>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;Manager&quot;:{</div>
<div class="line">        &quot;crs&quot;: {</div>
<div class="line">            &quot;root&quot;: {</div>
<div class="line">                &quot;isEpisodic&quot;: false,</div>
<div class="line">                &quot;baseName&quot;: &quot;CoordinateReferenceSystem&quot;,</div>
<div class="line">                &quot;entityFullName&quot;: &quot;rootCRS&quot;,</div>
<div class="line">                &quot;model&quot;:&quot;WGS84_geocentric&quot;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><ul>
<li>(例2) <a class="el" href="a182196.html" title="Entityの生成を行うクラス。">Factory</a> モデルを指定する場合</li>
</ul>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;Manager&quot;:{</div>
<div class="line">        &quot;crs&quot;: {</div>
<div class="line">            &quot;root&quot;: {</div>
<div class="line">                &quot;isEpisodic&quot;: false,</div>
<div class="line">                &quot;baseName&quot;: &quot;CoordinateReferenceSystem&quot;,</div>
<div class="line">                &quot;entityFullName&quot;: &quot;rootCRS&quot;,</div>
<div class="line">                &quot;model&quot;:&quot;WGS84_geocentric&quot;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_in_simulation_Ruler_localCRS"></a>
Ruler::localCRS</h2>
<p>シミュレーションのルール(戦域の形状等)を表現するために、 <a class="el" href="a182516.html" title="シミュレーションのルールを定義するクラス">Ruler</a> も独自のlocal CRSを <a class="el" href="a182516.html#adefc07cef660a7e638e20cc5ea8f828d" title="ルールを表現するための基準となるローカル座標系。直接ではなくgetLocalCRS()で参照することを想定。省略時は manager の rootCRS を使用する。">Ruler::localCRS</a> として保持する。 これは <a class="el" href="a182516.html#ae732750601eb707b58c38ba25b2a6d9d" title="ルールを表現するための基準となるローカル座標系を返す。初回呼び出し時にメンバ変数localCRSの値を設定する。派生クラスでカスタマイズしてよい。">Ruler::getLocalCRS()</a> によって取得可能であり、<a class="el" href="a186441.html#section_simulation_accessor_Ruler">RulerのAccessor</a> からも同名のメンバ関数により取得可能である。</p>
<h2 class="doxsection"><a class="anchor" id="section_simulation_Coordinate_in_simulation_Agent_localCRS"></a>
Agent::localCRS</h2>
<p>行動判断を計算するために、 <a class="el" href="a181948.html" title="Asset のうち、行動判断を行う主体としてシミュレータ外部とObservation,Actionを入出力するものを表すクラス">Agent</a> も独自のlocalCRSを持つことができる。 省略時は、自身が従う <a class="el" href="a182516.html" title="シミュレーションのルールを定義するクラス">Ruler</a> の localCRS を使用する。 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
